package ro.helator.dia.server.terminal;

import com.wittams.gritty.BackBuffer;
import com.wittams.gritty.Emulator;
import com.wittams.gritty.ScrollBuffer;
import com.wittams.gritty.StyleState;
import com.wittams.gritty.TerminalWriter;
import com.wittams.gritty.Tty;
import com.wittams.gritty.TtyChannel;
import com.wittams.gritty.swing.GrittyTerminal;
import com.wittams.gritty.swing.PreConnectHandler;
import com.wittams.gritty.swing.TermPanel;

import javafx.scene.layout.Pane;

import java.awt.BorderLayout;
import java.awt.Dimension;
import java.io.IOException;
import java.util.concurrent.atomic.AtomicBoolean;
import javax.swing.JPanel;
import javax.swing.JScrollBar;
import javax.swing.SwingUtilities;
import org.apache.log4j.Logger;

public class GrittyTerminalAdapter extends Pane {

	private static final Logger logger = Logger.getLogger(GrittyTerminal.class);
	private static final long serialVersionUID = -8213232075937432833L;
	private final StyleState styleState;
	private final BackBuffer backBuffer;
	private final ScrollBuffer scrollBuffer;
	private final TermPanel termPanel;
	private final JScrollBar scrollBar;
	private Tty tty;
	private TtyChannel ttyChannel;
	private TerminalWriter terminalWriter;
	private Emulator emulator;
	private Thread emuThread;
	private AtomicBoolean sessionRunning = new AtomicBoolean();
	private PreConnectHandler preconnectHandler;
	
	public GrittyTerminalAdapter() {

		this.styleState = new StyleState();
		this.backBuffer = new BackBuffer(80, 24, this.styleState);
		this.scrollBuffer = new ScrollBuffer();

		this.termPanel = new TermPanel(this.backBuffer, this.scrollBuffer, this.styleState);
		this.terminalWriter = new TerminalWriter(this.termPanel, this.backBuffer, this.styleState);
		this.preconnectHandler = new PreConnectHandler(this.terminalWriter);
		this.termPanel.setKeyHandler(this.preconnectHandler);
		this.scrollBar = new JScrollBar();

		add(this.termPanel, "Center");
		add(this.scrollBar, "East");
		this.scrollBar.setModel(this.termPanel.getBoundedRangeModel());
		this.sessionRunning.set(false);
	}

}
